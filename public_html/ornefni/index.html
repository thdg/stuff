<!DOCTYPE html>
<html lang="is">
    <head>
        <title>Örnefni</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <link rel="stylesheet" href="css/simple-grid.css">
        <link href="https://fonts.googleapis.com/css?family=Eagle+Lake|Oldenburg" rel="stylesheet">
        <link rel="stylesheet" href="css/ornefni.css">
    </head>
    <body>

        <div class="header">
            <div class="container">
                <h1 class="title">Örnefni</h1>
                <div class="row">
                    <div class="tabs col-12">
                        <div data-tab="map" class="tab map selected">
                            <h2>Kort</h2>
                        </div>
                        <div data-tab="npc" class="tab npc">
                            <h2>Persóna</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="forms">
            <div class="container">
                <form id="map" class="map" action="">
                    <div class="row groups">
                        <div class="col-4 col-sm-12">
                            <div class="radio-button active">
                                <input type="radio" id="sveit" name="group" value="sveit" selected/>
                                <label for="sveit">Sveit</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="land" name="group" value="land" />
                                <label for="land">Landörnefni</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="vatn" name="group" value="vatn" />
                                <label for="vatn">Vatnaörnefni</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="borg" name="group" value="borg" />
                                <label for="borg">Þéttbýli</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="sjor" name="group" value="sjor" />
                                <label for="sjor">Sjávarörnefni</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="jokull" name="group" value="jokull" />
                                <label for="jokull">Jökla- og snævarörnefni</label>
                            </div>
                        </div>
                    </div>

                    <div class="button">
                        <div class="wrapper">
                            <button type="button">Búa til örnefni</button>
                        </div>
                    </div>
                </form>
                <form id="npc" class="npc hidden" action="">
                    <div class="row groups">
                        <div class="col-4 col-sm-12">
                            <div class="radio-button active">
                                <input type="radio" id="kk" name="group" value="kk" selected/>
                                <label for="kk">Drenjanöfn</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="kvk" name="group" value="kvk" />
                                <label for="kvk">Stúlkunöfn</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="milli" name="group" value="milli" />
                                <label for="milli">Milli- og eftirnöfn</label>
                            </div>
                        </div>
                    </div>

                    <div class="button">
                        <div class="wrapper">
                            <button type="button">Búa til örnefni</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="names">
            <ul>
            </ul>
        </div>

        <div class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12 col-6">
                        <ul>
                            <li>
                                <a href="https://github.com/thdg">My Github</a>
                            </li>
                            <li>
                                <a href="https://linkedin.com/in/thorsteinndadi">LinkedIn profile</a>
                            </li>
                            <li>
                                <a href="https://mwlongsword.com">mwlongsword.com</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-sm-12 col-6 heraldry">
                        <img src="../img/shield-50.png" title="Azure, a tower argent." width="50px" class="float-right"/>
                    </div>
                </div>
            </div>
        </div>

        <script>
            var radios = document.querySelectorAll(".radio-button");
            for (var i = 0; i < radios.length; i++) {
                radios[i].addEventListener('click', function(event) {
                    console.log(this);
                    var radios = this.closest("form").querySelectorAll(".radio-button");
                    for (var i = 0; i < radios.length; i++) {
                        radios[i].classList.remove("active");
                    }
                    this.classList.add("active");
                });
            }

            function renderNames(names) {
                var container = document.querySelector(".names");
                var list = document.createElement("ul");
                for (var i = 0; i < names.length; i++) {
                    var item = document.createElement("li")
                    item.innerHTML = names[i];
                    list.appendChild(item);
                }
                container.innerHTML = "";
                container.appendChild(list);
            }

            function getNames(group, n, seed, filter) {
                var url = [
                    "/api/ornefni",
                    group,
                    n,
                    ""].join("/");
                if (seed) url += seed + "/"
                if (filter) url += "?ekkitil=1"

                var callback = function(response) {
                    var names = response["names"];
                    renderNames(names);
                }

                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                        callback(xmlHttp.response);
                }
                xmlHttp.responseType = 'json';
                xmlHttp.open("GET", url, true); // true for asynchronous
                xmlHttp.send(null);
            }

            var buttons = document.querySelectorAll(".button button")
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].onclick = function(event) {
                    var group = event.target.closest("form").querySelector(".radio-button.active input").value;
                    getNames(group, 11, "", true);
                }
            }
        </script>

        <script>
            var tabs = document.querySelectorAll(".tab");
            var forms = document.querySelectorAll("form");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].addEventListener('click', function(event) {

                    for (var i = 0; i < tabs.length; i++) {
                        tabs[i].classList.remove("selected");
                    }
                    this.classList.add("selected");

                    for (var i = 0; i < forms.length; i++) {
                        forms[i].classList.add("hidden");
                    }
                    document.querySelector("form#"+this.dataset["tab"]).classList.remove("hidden");
                });
            }
        </script>
    </body>
</html>
