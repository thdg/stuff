<!DOCTYPE html>
<html lang="is">
    <head>
        <title>Örnefni</title>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-116200472-1', 'auto');
            ga('set', 'anonymizeIp', true);
            ga('send', 'pageview');
        </script>

        <meta property="og:title" content="Örnefni" />
        <meta property="og:description" content="Slembinafnasmiðja fyrir heimssmiði og spunaspilara." />
        <meta property="og:image" content="http://xn--orsteinn-o6a.is/img/ornefni-fb.png" />

        <link rel="stylesheet" href="css/simple-grid.css">
        <link href="https://fonts.googleapis.com/css?family=Eagle+Lake|Oldenburg" rel="stylesheet">
        <link rel="stylesheet" href="css/ornefni.css">
    </head>
    <body>

        <div class="header">
            <div class="container">
                <h1 class="title">Örnefni</h1>
                <div class="row">
                    <div class="tabs col-12">
                        <div data-tab="map" class="tab-label map selected">
                            <h2>Kort</h2>
                        </div>
                        <div data-tab="npc" class="tab-label npc">
                            <h2>Persóna</h2>
                        </div>
			<div data-tab="npc2" class="tab-label npc2">
			    <h2>Ævintýrapersóna</h2>
			</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="forms">
            <div class="container">
                <form id="map" class="map tab" action="">
                    <div class="row groups">
                        <div class="col-3 col-sm-12">
                            <div class="radio-button active">
                                <input type="radio" id="sveit" name="group" value="sveit" selected/>
                                <label for="sveit">Sveit</label>
                            </div>
                        </div>
                        <div class="col-3 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="land" name="group" value="land" />
                                <label for="land">Landörnefni</label>
                            </div>
                        </div>
                        <div class="col-3 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="vatn" name="group" value="vatn" />
                                <label for="vatn">Vatnaörnefni</label>
                            </div>
                        </div>
                        <div class="col-3 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="borg" name="group" value="borg" />
                                <label for="borg">Þéttbýli</label>
                            </div>
                        </div>
                        <div class="col-3 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="sjor" name="group" value="sjor" />
                                <label for="sjor">Sjávarörnefni</label>
                            </div>
                        </div>
                        <div class="col-3 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="jokull" name="group" value="jokull" />
                                <label for="jokull">Jökla- og snævarörnefni</label>
                            </div>
                        </div>
                        <div class="col-3 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="gata" name="group" value="gata" />
                                <label for="gata">Götuheiti</label>
                            </div>
                        </div>
                        <div class="col-3 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="hus" name="group" value="hus" />
                                <label for="hus">Hús</label>
                            </div>
                        </div>
                    </div>

                    <div class="seed-type">
                        <input type="radio" id="for-map" name="reversed" value="for" checked />
                        <label for="for-map">Forskeyti:</label>
                        <input type="radio" id="vid-map" name="reversed" value="vid"/>
                        <label for="vid-map">Viðskeyti:</label>
                    </div>
                    <div class="seed">
                        <label for="map-seed">Forskeyti:</label>
                        <input id="map-seed" type="text" name="seed" />
                    </div>

                    <div class="button">
                        <div class="wrapper">
                            <button>Búa til örnefni</button>
                        </div>
                    </div>
                </form>
                <form id="npc" class="tab npc hidden" action="">
                    <div class="row groups">
                        <div class="col-4 col-sm-12">
                            <div class="radio-button active">
                                <input type="radio" id="kk" name="group" value="kk" selected/>
                                <label for="kk">Drengjanöfn</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="kvk" name="group" value="kvk" />
                                <label for="kvk">Stúlkunöfn</label>
                            </div>
                        </div>
                        <div class="col-4 col-sm-12">
                            <div class="radio-button">
                                <input type="radio" id="milli" name="group" value="milli" />
                                <label for="milli">Milli- og eftirnöfn</label>
                            </div>
                        </div>
                    </div>

                    <div class="seed-type">
                        <input type="radio" id="for-npc" name="reversed" value="for" checked />
                        <label for="for-npc">Forskeyti:</label>
                        <input type="radio" id="vid-npc" name="reversed" value="vid"/>
                        <label for="vid-npc">Viðskeyti:</label>
                    </div>
                    <div class="seed">
                        <label for="npc-seed">Forskeyti:</label>
                        <input id="npc-seed" type="text" name="seed" />
                    </div>

                    <div class="button">
                        <div class="wrapper">
                            <button>Búa til nöfn</button>
                        </div>
                    </div>
                </form>
                <div id="npc2" class="tab npc hidden" action="">
                    <div class="button">
			<p>Takkinn fyrir neðan setur saman slembilista af nöfnum með því að skeyta saman tveim orðum og setja fyrir aftan þekkt nafn. Sum nöfn gætu komið skringilega eða kjánalega út, hunsið þau. </p>
                        <div class="wrapper">
			    <button id="reload">Búa til nöfn</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="names">
        </div>

        <div class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12 col-6">
                        <ul>
                            <li>
                                <a href="https://github.com/thdg">My Github</a>
                            </li>
                            <li>
                                <a href="https://linkedin.com/in/thorsteinndadi">LinkedIn profile</a>
                            </li>
                            <li>
                                <a href="https://mwlongsword.com">mwlongsword.com</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-sm-12 col-6 heraldry">
                        <img src="../img/shield-50.png" title="Azure, a tower argent." width="50px" class="float-right"/>
                    </div>
                </div>
            </div>
        </div>

	<script>
// Based on https://slyflourish.com/random_name_generator.html
// Names have been changed to be Icelandic

function load_txt_file(fname) {
  var response = fetch(fname);
  var text = response.text();
  var list = text.split('\n').map(line => line.trim()).filter(Boolean);
  return list;	
}
var first_names = load_txt_file("first-names.txt");
var last_names_one = load_txt_file("last-names-one.txt");
var last_names_two = load_txt_file("last-names-two.txt");

function shuffle(list){
    for(var j, x, k = list.length; k; j = Math.floor(Math.random() * k), x = list[--k],list[k] = list[j], list[j] = x);
};

function generate_npc_names(count) {
    var output_string_list = [];
    for (var i=0;i<count;i++) {
        if(i % first_names.length == 0); shuffle(first_names);
        if(i % last_names_one.length == 0) shuffle(last_names_one);
        if(i % last_names_two.length == 0) shuffle(last_names_two);
        output_string_list.push(first_names[i % first_names.length] + " " + last_names_one[i % last_names_one.length] + last_names_two[i % last_names_two.length]);
    }
    //document.querySelector("div.names").html = "<p>"+output_string_list.join(", ");
												    renderNames(output_string_list);
}

    document.querySelector("#reload").addEventListener("click", function(){
        generate_npc_names(10);
    });

            var radios = document.querySelectorAll(".radio-button");
            for (var i = 0; i < radios.length; i++) {
                radios[i].addEventListener('click', function(event) {
                    var radios = this.closest("form").querySelectorAll(".radio-button");
                    for (var i = 0; i < radios.length; i++) {
                        radios[i].classList.remove("active");
                    }
                    this.classList.add("active");
                });
            }

            function renderNames(names) {
                var container = document.querySelector(".names");
                var list = document.createElement("ul");
                for (var i = 0; i < names.length; i++) {
                    var item = document.createElement("li")
                    item.innerHTML = names[i];
                    list.appendChild(item);
                }
                container.innerHTML = "";
                container.appendChild(list);
            }
												    function clearNames() {
                var container = document.querySelector(".names");
                container.innerHTML = "";							    }

            function renderError() {
                var container = document.querySelector(".names");
                var error = document.createElement("h3");
                error.innerHTML = "Fann engin örnefni með þessu forskeyti";
                error.classList.add("error")
                container.innerHTML = "";
                container.appendChild(error);
            }

            function getUrlParams(obj) {
                var params = [];
                for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        params.push(key + "=" + obj[key]);
                    }
                }
                if (params.length > 0) {
                    return "?" + params.join("&");
                } else {
                    return "";
                }
            }

            function getNames(group, n, seed, filter, reversed) {
                var url = [
                    "/api/ornefni",
                    group,
                    n,
                    ""].join("/");
                if (seed) url += seed + "/"
                params = {
                    "ekkitil": filter,
                    "aftur": reversed
                }
                url += getUrlParams(params);

                var callback = function(response) {
                    var names = response["names"];
                    renderNames(names);
                }

                var error = function() {
                    renderError();
                }

                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                        callback(xmlHttp.response);
                    }
                    else if (xmlHttp.readyState == 4) {
                        error();
                    }
                }
                xmlHttp.responseType = 'json';
                xmlHttp.open("GET", url, true);
                xmlHttp.send(null);
            }

            var canSubmit = true;
            var forms = document.querySelectorAll("form")
            for (var i = 0; i < forms.length; i++) {
                forms[i].onsubmit = function(event) {
                    event.preventDefault();
                    if (!canSubmit) {
                        return;
                    }

                    // Prevent submitting too often
                    canSubmit = false;
                    window.setTimeout(function() {
                        canSubmit = true;
                    }, 350);

                    var form = event.target;
                    var group = form.querySelector(".radio-button.active input").value;
                    var seed = form.querySelector(".seed input").value.trim();
                    var reversed = form.querySelector(".seed-type input:checked").value == "vid";
                    getNames(group, 11, seed, true, reversed);
                    ga('send', {
                      hitType: 'event',
                      eventCategory: 'Örnefni',
                      eventAction: form.id,
                      eventLabel: group
                    });
                    if (seed.length > 0) {
                        ga('send', {
                          hitType: 'event',
                          eventCategory: 'Örnefni',
                          eventAction: (reversed ? "vidskeyti" : "forskeyti"),
                          eventLabel: seed
                        });
                    }
                }
            }

            var tabs = document.querySelectorAll(".tab-label");
            var forms = document.querySelectorAll(".tab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].addEventListener('click', function(event) {
		    clearNames();
                    for (var i = 0; i < tabs.length; i++) {
                        tabs[i].classList.remove("selected");
                    }
                    this.classList.add("selected");

                    for (var i = 0; i < forms.length; i++) {
                        forms[i].classList.add("hidden");
                    }
                    document.querySelector(".tab#"+this.dataset["tab"]).classList.remove("hidden");
                });
            }
        </script>
    </body>
</html>
